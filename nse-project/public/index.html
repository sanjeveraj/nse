<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NSE All Stocks — Complete Listed Equities</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Loading rail -->
<div id="load-rail"></div>

<!-- ── TOP BAR ── -->
<header class="topbar">
  <div class="topbar-inner">
    <div class="logo">
      <span class="logo-nse">NSE</span><span class="logo-sep">·</span><span class="logo-pulse">Complete</span>
      <span class="logo-tag">ALL EQUITIES</span>
    </div>
    <div class="search-box">
      <input type="text" id="search" placeholder="Search symbol, company name, ISIN…" autocomplete="off" spellcheck="false">
      <svg class="search-icon" id="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      <button class="clear-btn" id="clear-btn" onclick="clearSearch()">✕</button>
    </div>
    <div class="status-chip" id="status-chip">
      <div class="dot"></div>
      <span id="status-text">Fetching NSE data…</span>
    </div>
    <div class="stat-pills">
      <div class="pill pill-total">Total: <span id="pill-total">—</span></div>
      <div class="pill pill-filtered">Shown: <span id="pill-filtered">—</span></div>
    </div>
  </div>
</header>

<!-- ── OVERVIEW CARDS ── -->
<div class="overview">
  <div class="ov-card"><div class="ov-val" id="ov-total">—</div><div class="ov-lbl">Total Listed Stocks</div></div>
  <div class="ov-card"><div class="ov-val" id="ov-eq">—</div><div class="ov-lbl">EQ Series</div></div>
  <div class="ov-card"><div class="ov-val" id="ov-be">—</div><div class="ov-lbl">BE / Trade-to-Trade</div></div>
  <div class="ov-card"><div class="ov-val" id="ov-sme">—</div><div class="ov-lbl">SME Platform</div></div>
  <div class="ov-card"><div class="ov-val" id="ov-other">—</div><div class="ov-lbl">Other Series</div></div>
</div>

<!-- ── CONTROLS ── -->
<div class="controls">
  <div class="filter-row">
    <span class="filter-label">Series</span>
    <div class="ser-chips" id="ser-chips">
      <span class="sch on" data-ser="ALL">All</span>
      <span class="sch" data-ser="EQ">EQ</span>
      <span class="sch" data-ser="BE">BE</span>
      <span class="sch" data-ser="BL">BL</span>
      <span class="sch" data-ser="SM">SM</span>
      <span class="sch" data-ser="ST">ST</span>
    </div>
    <span class="filter-label" style="margin-left:16px">Sort</span>
    <select class="sort-sel" id="sort-sel">
      <option value="sym-asc">Symbol A→Z</option>
      <option value="sym-desc">Symbol Z→A</option>
      <option value="name-asc">Name A→Z</option>
      <option value="name-desc">Name Z→A</option>
      <option value="date-desc">Listed Newest</option>
      <option value="date-asc">Listed Oldest</option>
      <option value="fv-asc">Face Value ↑</option>
      <option value="fv-desc">Face Value ↓</option>
    </select>
    <select class="pgsize-sel" id="pgsize-sel">
      <option value="50">50 / page</option>
      <option value="100" selected>100 / page</option>
      <option value="200">200 / page</option>
      <option value="500">500 / page</option>
    </select>
  </div>
  <div class="controls-right">
    <button class="btn btn-refresh" id="refresh-btn" onclick="loadNSEData()">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
      Refresh
    </button>
    <button class="btn btn-csv" onclick="exportCSV()">↓ CSV Export</button>
  </div>
</div>

<!-- ── TABLE ── -->
<div class="table-wrap">
  <div class="tcard">
    <div id="table-container">
      <div class="state-box">
        <div class="spinner-ring"></div>
        <div class="state-title">Loading NSE Equity List…</div>
        <div class="state-sub">Connecting to server proxy…</div>
      </div>
    </div>
  </div>
</div>

<!-- ── TOAST ── -->
<div class="toast" id="toast"></div>

<!-- ══ STOCK DETAIL MODAL ══ -->
<div class="modal-backdrop" id="modal-backdrop" onclick="handleBackdropClick(event)">
  <div class="modal-sheet" id="modal-sheet">
    <div class="modal-handle"></div>
    <div class="mh">
      <div class="mh-left">
        <div class="mh-sym" id="m-sym">—</div>
        <div class="mh-name" id="m-name">—</div>
        <div class="mh-price-row">
          <div class="mh-price" id="m-price">—</div>
          <div class="mh-chg flat" id="m-chg">—</div>
        </div>
        <div class="mh-ohlc" id="m-ohlc">—</div>
      </div>
      <button class="mh-close" onclick="closeModal()">✕</button>
    </div>
    <!-- Range tabs -->
    <div class="range-tabs">
      <button class="rtab active" onclick="setRange('1mo',this)">1M</button>
      <button class="rtab" onclick="setRange('3mo',this)">3M</button>
      <button class="rtab" onclick="setRange('6mo',this)">6M</button>
      <button class="rtab" onclick="setRange('1y',this)">1Y</button>
      <button class="rtab" onclick="setRange('2y',this)">2Y</button>
      <button class="rtab" onclick="setRange('5y',this)">5Y</button>
    </div>
    <!-- Chart -->
    <div class="chart-section">
      <div class="chart-title">
        <span>Candlestick Chart</span>
        <span id="chart-status" style="font-size:10px;color:var(--muted)">Yahoo Finance · NSE</span>
      </div>
      <div id="chart-loading" class="chart-loading">
        <div style="width:14px;height:14px;border:2px solid rgba(255,255,255,0.1);border-top-color:#00f5c4;border-radius:50%;animation:rot .7s linear infinite"></div>
        Fetching chart…
      </div>
      <canvas id="candle-canvas" style="display:none"></canvas>
      <div class="chart-tooltip" id="chart-tooltip">
        <div class="tt-date" id="tt-date">—</div>
        <div class="tt-row">
          <span class="tt-o">O:<b id="tt-o">—</b></span>
          <span class="tt-h">H:<b id="tt-h">—</b></span>
          <span class="tt-l">L:<b id="tt-l">—</b></span>
          <span class="tt-c">C:<b id="tt-c">—</b></span>
        </div>
      </div>
      <canvas id="vol-canvas" style="display:none"></canvas>
    </div>
    <!-- 52W Range -->
    <div class="w52-section" id="w52-section" style="display:none">
      <div class="fund-title">52-Week Range</div>
      <div class="w52-bar-wrap">
        <span class="w52-label" id="w52-low">—</span>
        <div class="w52-bar">
          <div class="w52-fill" id="w52-fill"></div>
          <div class="w52-marker" id="w52-marker"></div>
        </div>
        <span class="w52-label" id="w52-high">—</span>
      </div>
    </div>
    <!-- Info chips -->
    <div class="info-row" id="m-info-row"></div>
    <!-- Fundamentals -->
    <div class="fund-section">
      <div class="fund-title">Key Fundamentals</div>
      <div class="fund-grid" id="m-fund-grid"></div>
    </div>
    <!-- Analyst -->
    <div class="analyst-section" id="m-analyst-section" style="display:none">
      <div class="fund-title">Analyst Consensus</div>
      <div class="analyst-grid">
        <div class="analyst-card">
          <div class="analyst-label">Recommendations</div>
          <div class="buy-sell-bar" id="bsbar"></div>
          <div class="bar-labels">
            <span class="bl-buy" id="bl-buy">—</span>
            <span class="bl-hold" id="bl-hold">—</span>
            <span class="bl-sell" id="bl-sell">—</span>
          </div>
        </div>
        <div class="analyst-card">
          <div class="analyst-label">Price Target</div>
          <div class="target-val" id="tgt-price">—</div>
          <div class="target-upside" id="tgt-upside" style="color:var(--muted);font-size:12px">—</div>
        </div>
      </div>
    </div>
  </div><!-- end modal-sheet -->
</div><!-- end modal-backdrop -->

<script src="app.js"></script>
</body>
</html>
