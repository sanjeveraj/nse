<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NSE Stock Screener — Live Data</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- Top loading bar -->
<div id="load-rail"></div>

<!-- ════ HEADER ════ -->
<header class="topbar">
  <div class="topbar-inner">

    <div class="logo">
      <span class="logo-nse">NSE</span><span class="logo-sep">·</span><span class="logo-txt">Screener</span>
      <span class="logo-badge">LIVE</span>
    </div>

    <div class="search-wrap">
      <svg class="s-icon" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2">
        <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
      </svg>
      <input id="search" type="text" placeholder="Search symbol, company or ISIN…" autocomplete="off" spellcheck="false" />
      <button class="s-clear" id="s-clear" onclick="clearSearch()">✕</button>
    </div>

    <div class="status-pill" id="status-pill">
      <span class="s-dot"></span>
      <span id="status-txt">Connecting…</span>
    </div>

    <div class="count-pills">
      <span class="cpill">Total <b id="c-total">—</b></span>
      <span class="cpill accent">Shown <b id="c-shown">—</b></span>
    </div>

  </div>
</header>

<!-- ════ STAT CARDS ════ -->
<section class="stat-row">
  <div class="stat-card s1"><div class="sv" id="s-total">—</div><div class="sl">Total Listed</div></div>
  <div class="stat-card s2"><div class="sv" id="s-eq">—</div><div class="sl">EQ Series</div></div>
  <div class="stat-card s3"><div class="sv" id="s-be">—</div><div class="sl">BE Series</div></div>
  <div class="stat-card s4"><div class="sv" id="s-sme">—</div><div class="sl">SME Stocks</div></div>
  <div class="stat-card s5"><div class="sv" id="s-other">—</div><div class="sl">Other</div></div>
</section>

<!-- ════ CONTROLS ════ -->
<div class="ctrl-bar">
  <div class="ctrl-left">
    <label class="ctrl-lbl">Series</label>
    <div class="chip-group" id="chip-grp">
      <button class="chip active" data-ser="ALL">All</button>
      <button class="chip" data-ser="EQ">EQ</button>
      <button class="chip" data-ser="BE">BE</button>
      <button class="chip" data-ser="BL">BL</button>
      <button class="chip" data-ser="SM">SM</button>
      <button class="chip" data-ser="ST">ST</button>
    </div>
    <label class="ctrl-lbl">Sort</label>
    <select id="sort-sel" class="sel">
      <option value="sym-1">Symbol A→Z</option>
      <option value="sym--1">Symbol Z→A</option>
      <option value="name-1">Name A→Z</option>
      <option value="name--1">Name Z→A</option>
      <option value="date--1">Newest Listed</option>
      <option value="date-1">Oldest Listed</option>
      <option value="fv-1">Face Val ↑</option>
      <option value="fv--1">Face Val ↓</option>
    </select>
    <select id="pgsize-sel" class="sel">
      <option value="50">50 / page</option>
      <option value="100" selected>100 / page</option>
      <option value="200">200 / page</option>
      <option value="500">500 / page</option>
    </select>
  </div>
  <div class="ctrl-right">
    <button class="btn-outline" id="refresh-btn" onclick="loadData()">
      <svg id="refresh-ico" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <path d="M23 4v6h-6"/><path d="M1 20v-6h6"/>
        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
      </svg>
      Refresh
    </button>
    <button class="btn-solid" onclick="exportCSV()">↓ Export CSV</button>
  </div>
</div>

<!-- ════ TABLE ════ -->
<main class="main-wrap">
  <div class="table-card" id="table-card">
    <div class="state-box" id="state-box">
      <div class="ring-spin"></div>
      <p class="state-h">Loading NSE stocks…</p>
      <p class="state-p">Fetching all listed equities from NSE archives</p>
    </div>
  </div>
</main>

<!-- ════ TOAST ════ -->
<div class="toast" id="toast"></div>

<!-- ════ STOCK MODAL ════ -->
<div class="modal-bg" id="modal-bg" onclick="bgClick(event)">
  <div class="modal-box" id="modal-box">

    <div class="modal-drag"></div>

    <!-- Modal head -->
    <div class="modal-head">
      <div>
        <div class="m-sym" id="m-sym">—</div>
        <div class="m-name-row">
          <span class="m-name" id="m-name">—</span>
          <span class="live-tag" id="m-tag">
            <span class="tag-dot"></span>
            <span id="m-tag-txt">Loading…</span>
          </span>
        </div>
        <div class="m-price-row">
          <span class="m-price" id="m-price">—</span>
          <span class="m-chg" id="m-chg">—</span>
        </div>
        <div class="m-ohlc" id="m-ohlc">Fetching live price…</div>
      </div>
      <button class="modal-close" onclick="closeModal()">✕</button>
    </div>

    <!-- Range tabs -->
    <div class="range-row" id="range-row">
      <button class="rtab on" onclick="changeRange('1mo',this)">1M</button>
      <button class="rtab" onclick="changeRange('3mo',this)">3M</button>
      <button class="rtab" onclick="changeRange('6mo',this)">6M</button>
      <button class="rtab" onclick="changeRange('1y',this)">1Y</button>
      <button class="rtab" onclick="changeRange('2y',this)">2Y</button>
      <button class="rtab" onclick="changeRange('5y',this)">5Y</button>
    </div>

    <!-- Candlestick chart -->
    <div class="chart-wrap">
      <div class="chart-hdr">
        <span>Candlestick Chart</span>
        <span id="chart-src" class="chart-src">Yahoo Finance</span>
      </div>
      <div id="chart-loading" class="chart-load">
        <div class="mini-spin"></div> Fetching chart…
      </div>
      <canvas id="c-candle"></canvas>
      <canvas id="c-vol"></canvas>
      <div class="candle-tip" id="candle-tip">
        <div id="tip-date" class="tip-date">—</div>
        <div class="tip-vals">
          <span class="t-o">O <b id="tip-o">—</b></span>
          <span class="t-h">H <b id="tip-h">—</b></span>
          <span class="t-l">L <b id="tip-l">—</b></span>
          <span class="t-c">C <b id="tip-c">—</b></span>
        </div>
      </div>
    </div>

    <!-- 52W bar -->
    <div class="w52-wrap" id="w52-wrap" style="display:none">
      <div class="section-label">52-Week Range</div>
      <div class="w52-row">
        <span class="w52-num" id="w52-lo">—</span>
        <div class="w52-track">
          <div class="w52-fill" id="w52-fill"></div>
          <div class="w52-dot"  id="w52-dot"></div>
        </div>
        <span class="w52-num" id="w52-hi">—</span>
      </div>
    </div>

    <!-- Info chips -->
    <div class="info-chips" id="info-chips"></div>

    <!-- Fundamentals -->
    <div class="fund-section">
      <div class="section-label">Key Fundamentals</div>
      <div class="fund-grid" id="fund-grid"><!-- filled by JS --></div>
    </div>

    <!-- Analyst -->
    <div class="analyst-wrap" id="analyst-wrap" style="display:none">
      <div class="section-label">Analyst Consensus</div>
      <div class="analyst-row">
        <div class="an-card">
          <div class="an-lbl">Recommendations</div>
          <div class="an-bar" id="an-bar"></div>
          <div class="an-counts">
            <span class="ac-buy"  id="ac-buy">—</span>
            <span class="ac-hold" id="ac-hold">—</span>
            <span class="ac-sell" id="ac-sell">—</span>
          </div>
        </div>
        <div class="an-card">
          <div class="an-lbl">Analyst Price Target</div>
          <div class="an-target" id="an-target">—</div>
          <div class="an-upside" id="an-upside">—</div>
        </div>
      </div>
    </div>

  </div><!-- /modal-box -->
</div><!-- /modal-bg -->

<script src="app.js"></script>
</body>
</html>
